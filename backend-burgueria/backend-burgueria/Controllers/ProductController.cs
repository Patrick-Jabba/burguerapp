using Microsoft.AspNetCore.Mvc;
using backend_burgueria.Models;
using backend_burgueria.Context;

namespace backend_burgueria.Controllers
{
  [ApiController]
  [Route("product")]
  public class ProductController : ControllerBase
  {
    private readonly DataBaseContext _context;
    public ProductController(DataBaseContext context)
    {
      _context = context;
    }

    [HttpGet("listproducts")]
    public IActionResult GetProducts()
    {
      var lista = _context.Products.ToList();

      return Ok(lista);
    }

    [HttpPost]
    public IActionResult Create(Product product)
    {
      _context.Add(product);
      _context.SaveChanges();
      return Ok(product);
    }

    [HttpGet("{id}")]
    public IActionResult GetProductById(int id)
    {
      var product = _context.Products.Find(id);

      if (product == null)
      {
        return NotFound();
      }

      return Ok(product);
    }

    [HttpGet("GetByName")]
    public IActionResult GetProductByName(string name)
    {
      var products = _context.Products.Where(x => x.Name.Contains(name));

      return Ok(products);
    }

    [HttpPut("{id}")]
    public IActionResult Update(int id, Product product)
    {
      var dataBaseProduct = _context.Products.Find(id);

      if (dataBaseProduct == null)
      {
        return NotFound();
      }

      dataBaseProduct.Name = product.Name;
      dataBaseProduct.Description = product.Description;
      dataBaseProduct.Price = product.Price;
      // dataBaseProduct.IngredientId = product.IngredientId;

      _context.Products.Update(dataBaseProduct);
      _context.SaveChanges();
      return Ok(dataBaseProduct);
    }

    [HttpDelete("{id}")]
    public IActionResult Delete(int id)
    {
      var dataBaseProduct = _context.Products.Find(id);

      if (dataBaseProduct == null)
      {
        return NotFound();
      }

      _context.Products.Remove(dataBaseProduct);
      _context.SaveChanges();
      return NoContent();
    }
  }
}